<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/bootstrap.min.js"></script>
    <!--<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/jquery.validate.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/additional-methods.min.js"></script>-->
    <!--<script src="small_qas.js"></script>-->
    <!--<script src="baby_taskfile.js"></script>-->
    <script type="text/javascript">

        //////////////////////////////////// System functions. Used by legacy xplate submit & skip buttons. /////////////////////////////////////////////////
        function xPlate_GoForward() {
            top.xPlate.saveAndForward();
        };
        function xPlate_Skip() {
            top.xPlate.skipBatch();
        };
        function xPlate_GoBack() {
            top.xPlate.saveAndBacks();
        };
        //////////////////////////////////// Callback functions. These are called from UHRS onto your hitapp. /////////////////////////////////////////////////
        function xPlate_Validate() {
            // Called on save to determine if save can be processed.
            const hashCode = calculateHash(judgementData);
            top.xPlate.setJudgmentDataInt(hashCode);
            return true;
        };
        function xPlate_SubmitFeedback(appeal) {
            if (appeal && document.getElementById('xPlate_audit_comment').value == "") {
                alert("Please provide your comment first.");
                return;
            }
            top.xPlate.submitJudgeFeedback(appeals);
        };
        function xPlate_SubmitAudit() {
            if (document.getElementById('xPlate_audit_comment').value == "") {
                alert("Please provide your comment first.");
                return;
            }
            xPlate_GoForward();
        };
        // isFirstLoad = true for the initial loading of this Hit.
        // isFirstLoad = false if the Hit is being redisplayed to the judge (such as when review page is used, or RTAs being shown).
        function xPlate_OnLoad(isFirstLoad) {
            console.log("Got hit", JSON.parse(top.xPlate.getHitData('QuestionImageJson')));
            next();
        };

        //////////////////////////////////// End of system functions ///////////////////////////////////////////////

        var hitData = {};
        var judgementData = {};
        //var hitIndex = 0;

        function loadHit(){

            // For dev
            /*
            if (hitIndex === TASK_DATA.length) hitIndex = 0;
            hitData = TASK_DATA[hitIndex];
            hitIndex += 1;
            */

            hitData = JSON.parse(top.xPlate.getHitData('QuestionImageJson'));

            $("#figure-img").attr("src", hitData.image_url);

            for (var qix=0; qix<hitData.questions.length; qix++){
                $(".question[data-qix=" + qix.toString() + "]").text(hitData.questions[qix].question);
                $(".qa-row[data-qix=" + qix.toString() + "]").show();
            }
        }

        // Hashes the string formed by image_index(,question_index,answer_encoding)+
        // where answer_encoding = {0: 0, 1: 1, 2: 2}
        function calculateHash(judgementData) {
            var stringToEncode = judgementData.image_index.toString();

            for (const qa of judgementData.questions){
                stringToEncode += "," + qa.question_index + "," + qa.answer.toString();
            }

            var hash = 0, i, chr, len;

            for (i = 0, len = stringToEncode.length; i < len; i++) {
                chr = stringToEncode.charCodeAt(i);
                hash = ((hash << 5) - hash) + chr;
                hash = hash & hash; //convert to 32 bit integer value
            }
            return hash;
        }

        function saveJudgement(){

            judgementData = $.extend({}, hitData);

            for (var qix=0; qix<judgementData.questions.length; qix++){
                var answers = $(".answer.active[data-qix=" + qix.toString() + "]");

                if (answers.length === 0){
                    console.error("MISSING ANSWERS!");
                    alert("MISSING ANSWERS!");
                    return;
                }

                judgementData.questions[qix].answer = parseInt($(answers[0]).attr("data-ans"));
            }
            console.log("judgementData", judgementData);
            top.xPlate.setJudgmentData('JudgmentDataJson', JSON.stringify(judgementData));
            xPlate_GoForward();
            // For dev
            /*
            next();
            */
        }

        function next(){
            $(".answer").removeClass("active");
            $(".question").empty();
            $(".qa-row").hide();
            loadHit();
        }
        
        // for dev
        /*
        $(document).ready(function(){
            next();
        })
        */

    </script>
</head>
<style>
    .panel-title {
        font-size: 16pt;
        font-weight: bold;
    }
    .question {
        font-size: 18px;
    }
    .qa-row {
        border-bottom-color: rgb(221, 221, 221);
        border-bottom-style: solid;
        border-bottom-width: 1px;
        border-left-color: rgb(221, 221, 221);
        border-right-color: rgb(221, 221, 221);
        border-top-color: rgb(221, 221, 221);
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
        padding: 10px 0 10px 0;
        display: none;
    }
    #figure-img {
        height: auto;
        width: 100%;
    }
    #figure-img-container {
        height: auto;
        width: 100%;
    }
    @media only screen and (min-width: 601px){
        #figure-img-container {
            padding-left: 7.5%;
            padding-right: 7.5%;
        }
    }
    @media only screen and (min-width: 993px){
        #figure-img-container {
            padding-left: 15%;
            padding-right: 15%;
        }
    }
    @media only screen and (min-width: 1401px){
        #figure-img-container {
            padding-left: 25%;
            padding-right: 25%;
        }
    }
</style>
<body style="width:100%;height:100%;margin:0px;overflow:auto">
    <div class="container-fluid">

        <div class="panel panel-default">
            <div class="panel-heading" style="font-size: 40pt;">
                <h1 class="panel-title">Step 1: Inspect the figure</h1>
            </div>
            <div id="figure-img-container" class="panel-body">
                <img id="figure-img" src=""/>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Step 2: Answer the following questions</h3>
            </div>

            <div id="qa-container" class="container-fluid">
                <div class="row qa-row" data-qix=0>
                    <div class="col-xs-6 col-md-8 question" data-qix=0></div>
                    <div class="col-xs-6 col-md-4" style="text-align: right;">
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-lg answer" data-qix=0 data-ans=1>
                                <input type="radio">Yes
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=0 data-ans=0>
                                <input type="radio">No
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=0 data-ans=2>
                                <input type="radio">Unknown
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row qa-row" data-qix=1>
                    <div class="col-xs-6 col-md-8 question" data-qix=1></div>
                    <div class="col-xs-6 col-md-4" style="text-align: right;">
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-lg answer" data-qix=1 data-ans=1>
                                <input type="radio">Yes
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=1 data-ans=0>
                                <input type="radio">No
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=1 data-ans=2>
                                <input type="radio">Unknown
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row qa-row" data-qix=2>
                    <div class="col-xs-6 col-md-8 question" data-qix=2></div>
                    <div class="col-xs-6 col-md-4" style="text-align: right;">
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-lg answer" data-qix=2 data-ans=1>
                                <input type="radio">Yes
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=2 data-ans=0>
                                <input type="radio">No
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=2 data-ans=2>
                                <input type="radio">Unknown
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row qa-row" data-qix=3>
                    <div class="col-xs-6 col-md-8 question" data-qix=3></div>
                    <div class="col-xs-6 col-md-4" style="text-align: right;">
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-lg answer" data-qix=3 data-ans=1>
                                <input type="radio">Yes
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=3 data-ans=0>
                                <input type="radio">No
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=3 data-ans=2>
                                <input type="radio">Unknown
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row qa-row" data-qix=4>
                    <div class="col-xs-6 col-md-8 question" data-qix=4></div>
                    <div class="col-xs-6 col-md-4" style="text-align: right;">
                        <div class="btn-group" data-toggle="buttons">
                            <label class="btn btn-default btn-lg answer" data-qix=4 data-ans=1>
                                <input type="radio">Yes
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=4 data-ans=0>
                                <input type="radio">No
                            </label>
                            <label class="btn btn-default btn-lg answer" data-qix=4 data-ans=2>
                                <input type="radio">Unknown
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button id="submit-button" type="button" class="btn btn-primary btn-lg" onclick="saveJudgement()" style="width: 100%;">Submit</button>
        <!--<button id="submit-button" type="button" class="btn btn-primary btn-danger" onclick="next()" style="width: 100%;">Next</button>-->
    </div>
</body>
</html>